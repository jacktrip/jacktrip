<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   viewBox="0 0 1400 900"
   version="1.1"
   id="svg74"
   sodipodi:docname="flowchart2.svg"
   inkscape:version="1.4.2 (ebf0e940d0, 2025-05-08)"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <defs
     id="defs74" />
  <sodipodi:namedview
     id="namedview74"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:zoom="1.0955556"
     inkscape:cx="565.92292"
     inkscape:cy="412.11968"
     inkscape:window-width="1280"
     inkscape:window-height="737"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1"
     inkscape:current-layer="svg74" />
  <!-- Background -->
  <rect
     width="1400"
     height="900"
     fill="#ffffff"
     id="background"
     x="240.97362"
     y="21.906693" />
  <path
     d="m 399.78499,299.83976 h 75"
     stroke="#000000"
     stroke-width="2"
     fill="none"
     id="path67-6" />
  <!-- Title -->
  <text
     x="700"
     y="30"
     text-anchor="middle"
     font-size="20"
     font-weight="bold"
     fill="#000000"
     id="title">
    JackTrip Regulator Class - Actual Code Flow
  </text>
  <!-- INPUT PATH (Top Half) -->
  <text
     x="100"
     y="70"
     font-size="16"
     font-weight="bold"
     fill="#000000"
     id="text1">INPUT PATH (Network to Buffer)</text>
  <!-- Network Input -->
  <g
     id="network-input">
    <rect
       x="50"
       y="90"
       width="150"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect1" />
    <text
       x="125"
       y="115"
       text-anchor="middle"
       font-size="11"
       fill="#000000"
       id="text2">Network UDP</text>
    <text
       x="125"
       y="130"
       text-anchor="middle"
       font-size="11"
       fill="#000000"
       id="text3">Packet Arrives</text>
  </g>
  <!-- insertSlotNonBlocking -->
  <g
     id="insert-slot-nonblocking">
    <rect
       x="250"
       y="90"
       width="150"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect3" />
    <text
       x="325"
       y="110"
       text-anchor="middle"
       font-size="10"
       fill="#000000"
       id="text4">insertSlotNonBlocking()</text>
    <text
       x="325"
       y="125"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text5">sequence number check</text>
    <text
       x="325"
       y="140"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text6">setFPPratio() if needed</text>
  </g>
  <!-- pushPacket -->
  <g
     id="push-packet">
    <rect
       x="450"
       y="90"
       width="150"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect6" />
    <text
       x="525"
       y="115"
       text-anchor="middle"
       font-size="11"
       fill="#000000"
       id="text7">pushPacket()</text>
    <text
       x="525"
       y="130"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text8">Store in mSlots[]</text>
  </g>
  <!-- Ring Buffer Storage -->
  <g
     id="ring-buffer-storage">
    <rect
       x="650"
       y="90"
       width="150"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect8" />
    <text
       x="725"
       y="110"
       text-anchor="middle"
       font-size="11"
       fill="#000000"
       id="text9">Ring Buffer</text>
    <text
       x="725"
       y="125"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text10">mSlots[4096]</text>
    <text
       x="725"
       y="140"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text11">Packet stored</text>
  </g>
  <!-- OUTPUT PATH (Bottom Half) -->
  <text
     x="100"
     y="250"
     font-size="16"
     font-weight="bold"
     fill="#000000"
     id="text12">OUTPUT PATH (Buffer to Audio)</text>
  <!-- Audio Callback -->
  <g
     id="audio-callback">
    <rect
       x="50"
       y="270"
       width="150"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect12" />
    <text
       x="125"
       y="290"
       text-anchor="middle"
       font-size="11"
       fill="#000000"
       id="text13">Audio Callback</text>
    <text
       x="125"
       y="305"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text14">Every 1.33ms</text>
    <text
       x="125"
       y="320"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text15">Needs audio data</text>
  </g>
  <!-- readSlotNonBlocking -->
  <g
     id="read-slot-nonblocking">
    <rect
       x="250"
       y="270"
       width="150"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect15" />
    <text
       x="325"
       y="290"
       text-anchor="middle"
       font-size="10"
       fill="#000000"
       id="text16">readSlotNonBlocking()</text>
    <text
       x="325"
       y="305"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text17">Handle FPP ratios</text>
    <text
       x="325"
       y="320"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text18">Call pullPacket()</text>
  </g>
  <!-- pullPacket Decision Point -->
  <g
     id="pullpacket-decision">
    <polygon
       points="525,270 575,300 525,330 475,300"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="polygon18" />
    <text
       x="525"
       y="295"
       text-anchor="middle"
       font-size="10"
       fill="#000000"
       id="text19">pullPacket()</text>
    <text
       x="525"
       y="308"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text20">Packet found?</text>
  </g>
  <!-- PACKET FOUND Branch -->
  <g
     id="packet-found-branch">
    <rect
       x="650"
       y="270"
       width="150"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect20" />
    <text
       x="725"
       y="290"
       text-anchor="middle"
       font-size="10"
       fill="#000000"
       id="text21">PACKET FOUND</text>
    <text
       x="725"
       y="305"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text22">processPacket(false)</text>
    <text
       x="725"
       y="320"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text23">No glitch</text>
  </g>
  <!-- PACKET MISSING Branch -->
  <g
     id="packet-missing-branch">
    <rect
       x="450"
       y="380"
       width="150"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect23" />
    <text
       x="525"
       y="400"
       text-anchor="middle"
       font-size="10"
       fill="#000000"
       id="text24">PACKET MISSING</text>
    <text
       x="525"
       y="415"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text25">processPacket(true)</text>
    <text
       x="525"
       y="430"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text26">Glitch = true</text>
  </g>
  <!-- processPacket Details -->
  <g
     id="process-packet-details">
    <rect
       x="850"
       y="270"
       width="200"
       height="100"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect26" />
    <text
       x="950"
       y="290"
       text-anchor="middle"
       font-size="11"
       font-weight="bold"
       fill="#000000"
       id="text27">processPacket(glitch)</text>
    <text
       x="950"
       y="310"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text28">1. zeroTmpFloatBuf()</text>
    <text
       x="950"
       y="325"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text29">2. xfrBufferToFloatBuf()</text>
    <text
       x="950"
       y="340"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text30">3. burg(glitch) - PLC if needed</text>
    <text
       x="950"
       y="355"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text31">4. floatBufToXfrBuffer()</text>
  </g>
  <!-- Audio Output -->
  <g
     id="audio-output">
    <rect
       x="1100"
       y="270"
       width="150"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect31" />
    <text
       x="1175"
       y="295"
       text-anchor="middle"
       font-size="11"
       fill="#000000"
       id="text32">Audio Output</text>
    <text
       x="1175"
       y="315"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text33">To JACK/Hardware</text>
  </g>
  <!-- Key States from Code -->
  <g
     id="key-states">
    <rect
       x="50"
       y="500"
       width="1200"
       height="120"
       rx="10"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect33" />
    <text
       x="650"
       y="525"
       text-anchor="middle"
       font-size="14"
       font-weight="bold"
       fill="#000000"
       id="text34">Key Decision States from pullPacket() Code</text>
    <rect
       x="80"
       y="540"
       width="180"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect34" />
    <text
       x="170"
       y="560"
       text-anchor="middle"
       font-size="10"
       font-weight="bold"
       fill="#000000"
       id="text35">PACKETOK:</text>
    <text
       x="170"
       y="575"
       text-anchor="middle"
       font-size="8"
       fill="#000000"
       id="text36">pullStat-&gt;plcOverruns += skipped</text>
    <text
       x="170"
       y="588"
       text-anchor="middle"
       font-size="8"
       fill="#000000"
       id="text37">processPacket(skipped &amp;&amp; !mLastWasGlitch)</text>
    <rect
       x="280"
       y="540"
       width="180"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect37" />
    <text
       x="370"
       y="560"
       text-anchor="middle"
       font-size="10"
       font-weight="bold"
       fill="#000000"
       id="text38">UNDERRUN:</text>
    <text
       x="370"
       y="575"
       text-anchor="middle"
       font-size="8"
       fill="#000000"
       id="text39">pullStat-&gt;plcUnderruns++</text>
    <text
       x="370"
       y="588"
       text-anchor="middle"
       font-size="8"
       fill="#000000"
       id="text40">processPacket(true) - glitch</text>
    <rect
       x="480"
       y="540"
       width="180"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect40" />
    <text
       x="570"
       y="560"
       text-anchor="middle"
       font-size="10"
       font-weight="bold"
       fill="#000000"
       id="text41">ZERO_OUTPUT:</text>
    <text
       x="570"
       y="575"
       text-anchor="middle"
       font-size="8"
       fill="#000000"
       id="text42">memset(mXfrBuffer, 0, mPeerBytes)</text>
    <text
       x="570"
       y="588"
       text-anchor="middle"
       font-size="8"
       fill="#000000"
       id="text43">Silent audio output</text>
    <rect
       x="680"
       y="540"
       width="180"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect43" />
    <text
       x="770"
       y="560"
       text-anchor="middle"
       font-size="10"
       font-weight="bold"
       fill="#000000"
       id="text44">Worker Thread:</text>
    <text
       x="770"
       y="575"
       text-anchor="middle"
       font-size="8"
       fill="#000000"
       id="text45">enableWorker() when prediction</text>
    <text
       x="770"
       y="588"
       text-anchor="middle"
       font-size="8"
       fill="#000000"
       id="text46">mRegulatorWorkerPtr-&gt;pop()</text>
    <rect
       x="880"
       y="540"
       width="180"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect46" />
    <text
       x="970"
       y="560"
       text-anchor="middle"
       font-size="10"
       font-weight="bold"
       fill="#000000"
       id="text47">FPP Ratio Handling:</text>
    <text
       x="970"
       y="575"
       text-anchor="middle"
       font-size="8"
       fill="#000000"
       id="text48">mFPPratioNumerator/Denominator</text>
    <text
       x="970"
       y="588"
       text-anchor="middle"
       font-size="8"
       fill="#000000"
       id="text49">Multiple pulls or partial reads</text>
    <rect
       x="1080"
       y="540"
       width="180"
       height="60"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect49" />
    <text
       x="1170"
       y="560"
       text-anchor="middle"
       font-size="10"
       font-weight="bold"
       fill="#000000"
       id="text50">Timing Control:</text>
    <text
       x="1170"
       y="575"
       text-anchor="middle"
       font-size="8"
       fill="#000000"
       id="text51">gUdpWaitTimeout</text>
    <text
       x="1170"
       y="588"
       text-anchor="middle"
       font-size="8"
       fill="#000000"
       id="text52">mIncomingTiming[]</text>
  </g>
  <!-- Statistics -->
  <g
     id="statistics">
    <rect
       x="50"
       y="650"
       width="400"
       height="80"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect52" />
    <text
       x="250"
       y="675"
       text-anchor="middle"
       font-size="12"
       font-weight="bold"
       fill="#000000"
       id="text53">Statistics Tracked</text>
    <text
       x="80"
       y="695"
       font-size="9"
       fill="#000000"
       id="text54">• pullStat-&gt;plcOverruns (packets skipped)</text>
    <text
       x="80"
       y="710"
       font-size="9"
       fill="#000000"
       id="text55">• pullStat-&gt;plcUnderruns (packets late)</text>
    <text
       x="280"
       y="695"
       font-size="9"
       fill="#000000"
       id="text56">• mStatsMaxPLCdspElapsed</text>
    <text
       x="280"
       y="710"
       font-size="9"
       fill="#000000"
       id="text57">• mIncomingTiming[] array</text>
  </g>
  <!-- Configuration -->
  <g
     id="configuration">
    <rect
       x="500"
       y="650"
       width="400"
       height="80"
       rx="5"
       fill="#ffffff"
       stroke="#000000"
       stroke-width="2"
       id="rect57" />
    <text
       x="700"
       y="675"
       text-anchor="middle"
       font-size="12"
       font-weight="bold"
       fill="#000000"
       id="text58">Key Configuration</text>
    <text
       x="530"
       y="695"
       font-size="9"
       fill="#000000"
       id="text59">• mPeerFPP vs mLocalFPP ratios</text>
    <text
       x="530"
       y="710"
       font-size="9"
       fill="#000000"
       id="text60">• mPeerBytes, mLocalBytes packet sizes</text>
    <text
       x="730"
       y="695"
       font-size="9"
       fill="#000000"
       id="text61">• BurgAlgorithm for PLC</text>
    <text
       x="730"
       y="710"
       font-size="9"
       fill="#000000"
       id="text62">• Worker thread for prediction</text>
  </g>
  <!-- Arrows -->
  <g
     id="arrows">
    <!-- Input path arrows -->
    <path
       d="M 200 120 L 250 120"
       stroke="#000000"
       stroke-width="2"
       fill="none"
       id="path62" />
    <polygon
       points="247,117 257,120 247,123"
       fill="#000000"
       id="polygon62" />
    <path
       d="M 400 120 L 450 120"
       stroke="#000000"
       stroke-width="2"
       fill="none"
       id="path63" />
    <polygon
       points="447,117 457,120 447,123"
       fill="#000000"
       id="polygon63" />
    <path
       d="M 600 120 L 650 120"
       stroke="#000000"
       stroke-width="2"
       fill="none"
       id="path64" />
    <polygon
       points="647,117 657,120 647,123"
       fill="#000000"
       id="polygon64" />
    <!-- Output path arrows -->
    <path
       d="M 200 300 L 250 300"
       stroke="#000000"
       stroke-width="2"
       fill="none"
       id="path65" />
    <polygon
       points="247,297 257,300 247,303"
       fill="#000000"
       id="polygon65" />
    <path
       d="M 400 300 L 475 300"
       stroke="# 000000"
       stroke-width="2"
       fill="none"
       id="path66" />
    <polygon
       points="472,297 482,300 472,303"
       fill="#000000"
       id="polygon66" />
    <!-- Packet found path -->
    <path
       d="M 575 300 L 650 300"
       stroke="#000000"
       stroke-width="2"
       fill="none"
       id="path67" />
    <polygon
       points="647,297 657,300 647,303"
       fill="#000000"
       id="polygon67" />
    <text
       x="612"
       y="290"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text67">YES</text>
    <!-- Packet missing path -->
    <path
       d="M 525 330 L 525 380"
       stroke="#000000"
       stroke-width="2"
       fill="none"
       id="path68" />
    <polygon
       points="522,377 525,387 528,377"
       fill="#000000"
       id="polygon68" />
    <text
       x="540"
       y="355"
       font-size="9"
       fill="#000000"
       id="text68">NO/LATE</text>
    <!-- To processPacket -->
    <path
       d="M 800 300 L 850 300"
       stroke="#000000"
       stroke-width="2"
       fill="none"
       id="path69" />
    <polygon
       points="847,297 857,300 847,303"
       fill="#000000"
       id="polygon69" />
    <!-- Missing packet to processPacket -->
    <path
       d="M 600 410 Q 750 350 850 320"
       stroke="#000000"
       stroke-width="2"
       fill="none"
       stroke-dasharray="5,5"
       id="path70" />
    <polygon
       points="847,317 857,320 847,323"
       fill="#000000"
       id="polygon70" />
    <!-- To audio output -->
    <path
       d="M 1050 300 L 1100 300"
       stroke="#000000"
       stroke-width="2"
       fill="none"
       id="path71" />
    <polygon
       points="1097,297 1107,300 1097,303"
       fill="#000000"
       id="polygon71" />
    <!-- Storage to decision (lookup) -->
    <path
       d="M 725 150 Q 725 200 575 270"
       stroke="#000000"
       stroke-width="2"
       fill="none"
       stroke-dasharray="3,3"
       id="path72" />
    <polygon
       points="572,267 582,270 572,273"
       fill="#000000"
       id="polygon72" />
    <text
       x="650"
       y="210"
       text-anchor="middle"
       font-size="9"
       fill="#000000"
       id="text72">Lookup packet</text>
  </g>
  <!-- Flow labels -->
  <text
     x="700"
     y="50"
     text-anchor="middle"
     font-size="12"
     fill="#000000"
     id="text73">
    Two Independent Paths: Network Input (Top) and Audio Output (Bottom)
  </text>
  <!-- Timing note -->
  <text
     x="700"
     y="850"
     text-anchor="middle"
     font-size="11"
     font-weight="bold"
     fill="#000000"
     id="text74">
    Critical: Audio callbacks are time-critical (1.33ms), packet arrival is asynchronous
  </text>
</svg>
